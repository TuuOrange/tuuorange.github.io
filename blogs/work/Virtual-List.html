<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟列表 | TuuOrange&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="TuuOrange的个人博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.5b7d175f.css" as="style"><link rel="preload" href="/assets/js/app.7f47a672.js" as="script"><link rel="preload" href="/assets/js/7.4a690826.js" as="script"><link rel="preload" href="/assets/js/2.cf00603f.js" as="script"><link rel="preload" href="/assets/js/1.24c33125.js" as="script"><link rel="preload" href="/assets/js/57.bc530ef3.js" as="script"><link rel="prefetch" href="/assets/js/10.84748966.js"><link rel="prefetch" href="/assets/js/11.10607a13.js"><link rel="prefetch" href="/assets/js/14.f5128372.js"><link rel="prefetch" href="/assets/js/15.0d3b9d53.js"><link rel="prefetch" href="/assets/js/16.08b5e341.js"><link rel="prefetch" href="/assets/js/17.5a8a2ea1.js"><link rel="prefetch" href="/assets/js/18.0f141714.js"><link rel="prefetch" href="/assets/js/19.9931904e.js"><link rel="prefetch" href="/assets/js/20.5583de5f.js"><link rel="prefetch" href="/assets/js/21.267a72fd.js"><link rel="prefetch" href="/assets/js/22.d1e9ce6b.js"><link rel="prefetch" href="/assets/js/23.9eaf0029.js"><link rel="prefetch" href="/assets/js/24.2d54b90b.js"><link rel="prefetch" href="/assets/js/25.f8062814.js"><link rel="prefetch" href="/assets/js/26.b9145f76.js"><link rel="prefetch" href="/assets/js/27.a19f82c2.js"><link rel="prefetch" href="/assets/js/28.6a09d2de.js"><link rel="prefetch" href="/assets/js/29.a2d710e2.js"><link rel="prefetch" href="/assets/js/3.7ac70fef.js"><link rel="prefetch" href="/assets/js/30.025f9fd5.js"><link rel="prefetch" href="/assets/js/31.035d4ed8.js"><link rel="prefetch" href="/assets/js/32.1313883a.js"><link rel="prefetch" href="/assets/js/33.7ad28301.js"><link rel="prefetch" href="/assets/js/34.9c8e3ec7.js"><link rel="prefetch" href="/assets/js/35.9ff5e28a.js"><link rel="prefetch" href="/assets/js/36.a02aa98d.js"><link rel="prefetch" href="/assets/js/37.b8f1599f.js"><link rel="prefetch" href="/assets/js/38.041ae261.js"><link rel="prefetch" href="/assets/js/39.375582cc.js"><link rel="prefetch" href="/assets/js/4.8ed65458.js"><link rel="prefetch" href="/assets/js/40.93ecaf70.js"><link rel="prefetch" href="/assets/js/41.5cec47f2.js"><link rel="prefetch" href="/assets/js/42.5ac4b275.js"><link rel="prefetch" href="/assets/js/43.a4317382.js"><link rel="prefetch" href="/assets/js/44.e0ada0a8.js"><link rel="prefetch" href="/assets/js/45.e9a61f2f.js"><link rel="prefetch" href="/assets/js/46.1027b7a2.js"><link rel="prefetch" href="/assets/js/47.6e690e61.js"><link rel="prefetch" href="/assets/js/48.344428a0.js"><link rel="prefetch" href="/assets/js/49.019139dd.js"><link rel="prefetch" href="/assets/js/5.a2fcbd13.js"><link rel="prefetch" href="/assets/js/50.0d9541ef.js"><link rel="prefetch" href="/assets/js/51.418a01bf.js"><link rel="prefetch" href="/assets/js/52.c6fc8100.js"><link rel="prefetch" href="/assets/js/53.3f797ac1.js"><link rel="prefetch" href="/assets/js/54.513c0c49.js"><link rel="prefetch" href="/assets/js/55.704b9cc8.js"><link rel="prefetch" href="/assets/js/56.18df7acf.js"><link rel="prefetch" href="/assets/js/58.65c54473.js"><link rel="prefetch" href="/assets/js/6.6cda327d.js"><link rel="prefetch" href="/assets/js/8.985dc236.js"><link rel="prefetch" href="/assets/js/9.254a41a0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4d1db424.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b7d175f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>TuuOrange's Blog</h3> <p class="description" data-v-59e6cb88>TuuOrange的个人博客</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>TuuOrange</span>
          
        <!---->
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="TuuOrange's Blog" class="logo"> <span class="site-name">TuuOrange's Blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/学习总结/" class="nav-link"><i class="undefined"></i>
  学习总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/个人简历/" class="nav-link"><i class="undefined"></i>
  个人简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/工作总结/" class="nav-link"><i class="undefined"></i>
  工作总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      TuuOrange
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/TuuOrange" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1011206430395310" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    TuuOrange
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>20</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>27</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/学习总结/" class="nav-link"><i class="undefined"></i>
  学习总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/个人简历/" class="nav-link"><i class="undefined"></i>
  个人简历
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/categories/工作总结/" class="nav-link"><i class="undefined"></i>
  工作总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      TuuOrange
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/TuuOrange" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1011206430395310" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>虚拟列表</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>TuuOrange</span>
          
        <!---->
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">虚拟列表</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>TuuOrange</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>4/16/2025</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>工作</span><span class="tag-item" data-v-8a445198>工作总结</span><span class="tag-item" data-v-8a445198>学习</span><span class="tag-item" data-v-8a445198>学习总结</span><span class="tag-item" data-v-8a445198>性能优化</span><span class="tag-item" data-v-8a445198>虚拟列表</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="为什么需要实现虚拟列表"><a href="#为什么需要实现虚拟列表" class="header-anchor">#</a> 为什么需要实现虚拟列表？</h2> <p>因为大量操作 DOM 可能会出现白屏和闪屏</p> <ul><li><p>白屏：在极端情况下，如果 DOM 操作过于复杂或者耗时，浏览器可能无法在短时间内完成渲染，导致页面出现空白状态，直到渲染完成（比如滚动过快过长）</p></li> <li><p>闪屏：当浏览器试图渲染大量的 DOM 元素时，如果 DOM 操作过于密集，浏览器可能无法及时完成渲染，导致用户看到部分渲染的内容，造成屏幕闪烁</p></li></ul> <h3 id="分批量渲染"><a href="#分批量渲染" class="header-anchor">#</a> 分批量渲染</h3> <p>数据过多，可以进行批量渲染（懒加载渲染）。</p> <ul><li>递归渲染函数</li> <li>setTimeout -&gt; rAF</li> <li>使用 DocumentFragment 批量插入，可以减少回流重绘</li></ul> <p>但是在渲染后得到的数据还是过多，渲染的内容过多，导致资源消耗过多，CPU 承载过多。所以我们可以使用虚拟列表来规范渲染空间。</p> <h2 id="定高虚拟列表"><a href="#定高虚拟列表" class="header-anchor">#</a> 定高虚拟列表</h2> <p>我们先谈谈虚拟列表的实现核心。</p> <div class="custom-block tip"><p class="title"></p><p>虚拟列表的核心实现是<strong>只渲染可视区域内的内容</strong>，而在窗口外的元素都是空 div，性能开销小到可以忽略不计（在页面上建 10w 个 div 都不会卡顿）</p></div><h3 id="虚拟列表需要的数据"><a href="#虚拟列表需要的数据" class="header-anchor">#</a> 虚拟列表需要的数据</h3> <ul><li>startIndex</li> <li>endIndex</li> <li>itemSize</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>totalListHeight <span class="token operator">=</span> data<span class="token punctuation">.</span>length <span class="token operator">*</span> itemSize<span class="token punctuation">;</span> <span class="token comment">// 总列表高度</span>
visibleAreaItemsNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>listHeight <span class="token operator">/</span> itemSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可视区域的item数量</span>
startIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> itemSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始下标</span>
endIndex <span class="token operator">=</span> startIndex <span class="token operator">+</span> visibleAreaItemsNum<span class="token punctuation">;</span> <span class="token comment">// 结束下标</span>
</code></pre></div><h3 id="上下缓冲区"><a href="#上下缓冲区" class="header-anchor">#</a> 上下缓冲区</h3> <p>缓冲区是为了在滚动的时候不会出现空白断层。</p> <p>当我们滚动触发过快没有被触发重新计算时，我们可以适当增加我们上下缓冲区的区域，这样就可以尽量（非百分百）避免滚动太快而没有触发的情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可视数据（包括缓冲区）</span>
visibleData <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startIndex <span class="token operator">-</span> bufferNum<span class="token punctuation">,</span> endIndex <span class="token operator">+</span> bufferNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="缓冲区的数据设计"><a href="#缓冲区的数据设计" class="header-anchor">#</a> 缓冲区的数据设计</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">bufferPercent</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 即每个缓冲区只缓冲 0.5 * 最大可见列表项数 个元素（向下取整，避免过多数据）</span>
</code></pre></div><h3 id="偏移量-offset"><a href="#偏移量-offset" class="header-anchor">#</a> 偏移量 offset</h3> <p>虚拟列表的核心是动态渲染可视区域的内容。当用户滚动时，需要通过偏移量（offset）调整列表的位置，模拟完整列表的滚动效果</p> <h2 id="不定高虚拟列表"><a href="#不定高虚拟列表" class="header-anchor">#</a> 不定高虚拟列表</h2> <p>不定高的虚拟列表其实和定高虚拟列表实现原理差不多，只是不定高虚拟列表需要设计一个预估的 item 高度，在渲染数据后要再获取真实的高度再更新整体的可视区域的高度，还要保存每一个数据所在的高度（startIndex、自身高度、所在的整个全数据列表的高度）</p> <p>同时，也通过节流（200ms 左右计算一次）进行渲染，用 rAF 代替定时器进行优化（替代节流，在 rAF 时间内渲染）</p> <p>用户可视区滚动，脱离可视区域进入到缓冲区域之后，开始加载下一个区域的数据，在脱离缓冲区之后，下一部分的数据差不多已经加载渲染完毕。</p> <p>同时，配合懒加载实现（懒加载的时候注意要添加 loading 标记是否已经开始加载）</p> <h3 id="具体实现步骤"><a href="#具体实现步骤" class="header-anchor">#</a> 具体实现步骤</h3> <h4 id="_1-mounted-之后-监听-listref-的-value-更新以及源数据-datasource-的长度变化之后-开始初始化预估数组"><a href="#_1-mounted-之后-监听-listref-的-value-更新以及源数据-datasource-的长度变化之后-开始初始化预估数组" class="header-anchor">#</a> 1. mounted 之后/监听 listRef 的 value 更新以及源数据 dataSource 的长度变化之后：开始初始化预估数组</h4> <p>预测高度尽量小一点，宁可数据多一点（不会卡顿），也尽量减少空白</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 初始化maxCount，可存放的最大数值</span>
<span class="token keyword">const</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>viewHeight <span class="token operator">=</span> contentRef<span class="token punctuation">.</span>value <span class="token operator">?</span> contentRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>OffsetHeight <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 获取的容器（视口）的高度</span>
  state<span class="token punctuation">.</span>maxCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>viewHeight <span class="token operator">/</span> props<span class="token punctuation">.</span>estimatedHeight<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 视口高度 / 预估item高度 + 1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>通过<code>startIndex</code>计算出其他的数据，要设置 listRef 的动态高度和偏移量</p> <p>虚拟列表的核心是动态渲染可视区域的内容。当用户滚动时，需要通过**偏移量（offset）**调整列表的位置，模拟完整列表的滚动效果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> endIndex <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span>length<span class="token punctuation">,</span> state<span class="token punctuation">.</span>startIndex <span class="token operator">+</span> state<span class="token punctuation">.</span>maxCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> renderList <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>startIndex<span class="token punctuation">,</span> endIndex<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> offsetDis <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>startIndex <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> position<span class="token punctuation">.</span>value<span class="token punctuation">[</span>state<span class="token punctuation">.</span>startIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 偏移量（视口开始item的上一个item的bottom）</span>
<span class="token keyword">const</span> scrollStyle <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>listHeight <span class="token operator">-</span> offsetDis<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 列表高度 - 偏移量</span>
    <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3D(0, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offsetDis<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, 0)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 向下移动偏移量距离</span>
  <span class="token punctuation">}</span> <span class="token keyword">as</span> CSSProperties<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>请求新的数据的话，之前的 top 和 bottom 都要补上（position 数组要更新为新的渲染数组）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 初始化：拿到数据源初始化pos数组</span>
<span class="token keyword">const</span> <span class="token function-variable function">initPosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">pos</span><span class="token operator">:</span> IPosInfol<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> disLen <span class="token operator">=</span> props<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>length <span class="token operator">-</span> state<span class="token punctuation">.</span>preLen<span class="token punctuation">;</span>
  <span class="token keyword">const</span> pretop <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>top <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prebottom <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bottom <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> disLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> props<span class="token punctuation">.</span>dataSource<span class="token punctuation">[</span>state<span class="token punctuation">.</span>preLen <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    pos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">index</span><span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> props<span class="token punctuation">.</span>estimatedHeight<span class="token punctuation">,</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span> preTop <span class="token operator">?</span> preTop <span class="token operator">+</span> i <span class="token operator">*</span> props<span class="token punctuation">.</span>estimatedHeight <span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token operator">*</span> props<span class="token punctuation">.</span>estimatedHeight<span class="token punctuation">,</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span> preBottom <span class="token operator">?</span> preBottom <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> props<span class="token punctuation">.</span>estimatedHeight <span class="token operator">:</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> props<span class="token punctuation">.</span>estimatedHeight<span class="token punctuation">,</span>
      <span class="token literal-property property">dHeight</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  positions<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token operator">...</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>
  state<span class="token punctuation">.</span>prelen <span class="token operator">=</span> props<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-nexttick-中-dom-更新之后-获取数据-更新真实数据数组-根据真实的高度获取高度差判断是否需要更新-并更新-bottom、height、dheight"><a href="#_2-nexttick-中-dom-更新之后-获取数据-更新真实数据数组-根据真实的高度获取高度差判断是否需要更新-并更新-bottom、height、dheight" class="header-anchor">#</a> 2. nextTick 中（DOM 更新之后）：获取数据，更新真实数据数组，根据真实的高度获取高度差判断是否需要更新，并更新 bottom、height、dHeight</h4> <p>每一个 item 的高度差更新完，都要将数据重新遍历一遍，重新计算更新 list 渲染数组中所有数据的 top 和 bottom（列表的最后一项就是 listHeight 的高度）</p> <p>要累加高度差值才能更新数组的所有 top 和 bottom，从上往下完整更新</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 数据 item 渲染完成后，实时更新item的真实高度</span>
<span class="token keyword">const</span> <span class="token function-variable function">setPosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nodes <span class="token operator">=</span> listRef<span class="token punctuation">.</span>value<span class="token operator">?.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Inodes <span class="token operator">||</span> <span class="token operator">/</span>nodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    ［<span class="token operator">...</span>nodes］<span class="token operator">-</span><span class="token function">fonEach（</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">const</span> rect <span class="token operator">=</span> node<span class="token punctuation">.</span>getBoundingClientRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token operator">+</span>node<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> deight <span class="token operator">=</span> item<span class="token punctuation">.</span> height <span class="token operator">-</span> rect<span class="token punctuation">.</span> height<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span> height <span class="token operator">=</span> rect<span class="token punctuation">.</span> height<span class="token punctuation">;</span>
      item<span class="token punctuation">.</span> bottom <span class="token operator">=</span> item<span class="token punctuation">.</span> bottom <span class="token operator">-</span> dHeight<span class="token punctuation">;</span>
      item<span class="token punctuation">.</span> dHeight <span class="token operator">=</span> dHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> startId <span class="token operator">=</span> <span class="token operator">+</span>nodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span> id<span class="token punctuation">;</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">let</span> startHeight <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>startId<span class="token punctuation">]</span><span class="token punctuation">.</span> dHeight<span class="token punctuation">;</span>
  positions<span class="token punctuation">.</span> value<span class="token punctuation">[</span>startId<span class="token punctuation">]</span> dHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> startId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> positions<span class="token punctuation">.</span>value<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span> top <span class="token operator">=</span> positions<span class="token punctuation">.</span> value<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span> bottom<span class="token punctuation">;</span>
    item<span class="token punctuation">.</span> bottom <span class="token operator">=</span> item<span class="token punctuation">.</span> bottom <span class="token operator">-</span> startHeight<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span> dHeight <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>
      startHeight <span class="token operator">+=</span> item<span class="token punctuation">.</span>dHeight<span class="token punctuation">;</span>
      item<span class="token punctuation">.</span>dHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-监听滚动-scroll-获取滚动的距离-scrolltop-根据二分法获取当前滚到的-item-的-index-作为-startindex-scrolltop-与-bottom-进行比较"><a href="#_3-监听滚动-scroll-获取滚动的距离-scrolltop-根据二分法获取当前滚到的-item-的-index-作为-startindex-scrolltop-与-bottom-进行比较" class="header-anchor">#</a> 3. 监听滚动 scroll，获取滚动的距离 scrollTop；根据<strong>二分法</strong>获取当前滚到的 item 的 index 作为 startIndex（scrollTop 与 bottom 进行比较）</h4> <p>如果没有找到，说明第一个元素并没有滚动出去</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">handlescroll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> scrolltop<span class="token punctuation">,</span> clientHeight<span class="token punctuation">,</span> scrollHeight <span class="token number">3</span> <span class="token operator">=</span> contentRef<span class="token punctuation">.</span> value<span class="token operator">!</span> <span class="token punctuation">;</span>
  state<span class="token punctuation">.</span> startIndex <span class="token operator">=</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>positions<span class="token punctuation">.</span>value<span class="token punctuation">,</span> scroleTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">binarysearch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">list</span><span class="token operator">:</span> IPosInfo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  right <span class="token operator">=</span> list<span class="token punctuation">.</span> length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
  templateIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> midIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span> <span class="token function">floor</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> midValue <span class="token operator">=</span> list<span class="token punctuation">[</span>midIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>midvalue <span class="token operator">===</span> value<span class="token punctuation">)</span> <span class="token keyword">return</span> midIndex<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>midvalue <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> left <span class="token operator">=</span> midIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>midvalue <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>templateIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> templateIndex › midIndex<span class="token punctuation">)</span> templateIndex <span class="token operator">=</span> midIndex<span class="token punctuation">;</span>
      right <span class="token operator">=</span> midIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> templateINdex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>触发触底，则请求数据；添加<code>!props.loading</code>是为了防止多次请求，只有 loading 没有加载的时候（说明还没触发）才会请求新数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bottom <span class="token operator">=</span> scrollheight <span class="token operator">-</span> clientHeight <span class="token operator">-</span> scrollTop<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>bottom <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">!</span>props<span class="token punctuation">.</span>loading <span class="token operator">&amp;&amp;</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;getMoreData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获取数据之后，再开始以上的步骤（滚动监听更新 startIndex 和根据 startIndex 更新其他数据）</p> <p>页面销毁时注意要清除 scroll 的监听</p> <h2 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h2> <h4 id="通过-raf-代替节流减少滚动造成的损耗"><a href="#通过-raf-代替节流减少滚动造成的损耗" class="header-anchor">#</a> 通过 rAF 代替节流减少滚动造成的损耗</h4> <p>一开始使用时间计算，200ms 触发一次，但是往上滑到顶上时可能会出现白屏，因为没有被监听到变化</p> <p>解决：rAF 代替节流，流畅，不会出现以上问题</p> <h4 id="resizeobserver-监听高度变化"><a href="#resizeobserver-监听高度变化" class="header-anchor">#</a> ResizeObserver 监听高度变化</h4> <h4 id="异步加载-如果一定要处理列表异步加载不定高元素的场景-我们通过-img-onload-和-resizeobserver-在加载完成后更新列表-动态高度"><a href="#异步加载-如果一定要处理列表异步加载不定高元素的场景-我们通过-img-onload-和-resizeobserver-在加载完成后更新列表-动态高度" class="header-anchor">#</a> 异步加载：如果一定要处理列表异步加载不定高元素的场景，我们通过 img.onload 和 ResizeObserver 在加载完成后更新列表（动态高度）</h4> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ol><li>不定高：由于很难拿到真实高度的数据，所以采取预估高度初始化后重新渲染的方式来正确渲染不定高内容，并重写了滚动回调函数和部分与 itemSize 相关的计算属性</li></ol> <ul><li>主要要获取<strong>startIndex</strong>的索引，可以通过<strong>二分法</strong>对滚动距离 scrollTop 和元素的 bottom 进行比较，得到对应的 startIndex，通过 startIndex 获知其他索引和内容</li> <li>在进入缓冲区时，开始加载下一个视口的数据，等过了缓冲区，数据就已经加载完毕了</li></ul> <ol start="2"><li><p>缓冲区：为了解决性能低时数据渲染不及时造成的白屏闪烁，我们创建上下缓冲区额外渲染数据，为可视区的渲染提供更多缓冲时间。为此要重写 start/end 和 currentOffset 的计算方式</p></li> <li><p>异步加载：如果一定要处理列表异步加载不定高元素的场景，我们通过 <strong>img.onload</strong> 和 <strong>ResizeObserver</strong> 在加载完成后更新列表（动态高度）</p></li> <li><p>懒加载：一次性大量数据的请求可能会导致请求响应时间变长，我们使用触底加载新数据并更新 positions 的方式来分化单次请求的数据量</p></li></ol> <div class="custom-block tip"><p class="title"></p><p>参考自：
https://www.bilibili.com/video/BV1wh4y1y7TM/?spm_id_from=333.337.search-card.all.click&amp;vd_source=aa98d9360aac11f90a8406ab44f3a20c手写JS代码</p></div><h2 id="补充-intersectionobserver-可以知道目标元素与视口之间的交叉区域"><a href="#补充-intersectionobserver-可以知道目标元素与视口之间的交叉区域" class="header-anchor">#</a> 补充 - IntersectionObserver 可以知道目标元素与视口之间的交叉区域</h2> <p>一个 IntersectionObserver 可以监听多个目标元素，并通过队列维护回调的执行顺序</p> <p>IntersectionObserver 特别适用于：滚动动画、懒加载、虚拟列表等场景</p> <ul><li>observe：开始监听目标元素</li> <li>unobserve：停止监听目标元素</li> <li>disconnect：关闭观察器</li> <li>takeRecords：返回所有观察目标的 IntersectionObserverEntry 对象数组</li></ul> <h3 id="浏览器-fps-大概-16ms-当快速滚动的时候-intersectionobserver-可视区域监听有概率不触发回调-展示上虚拟列表有些列表区域是空白的"><a href="#浏览器-fps-大概-16ms-当快速滚动的时候-intersectionobserver-可视区域监听有概率不触发回调-展示上虚拟列表有些列表区域是空白的" class="header-anchor">#</a> 浏览器 fps 大概 16ms，当快速滚动的时候，IntersectionObserver 可视区域监听有概率不触发回调，展示上虚拟列表有些列表区域是空白的</h3> <ol><li>替换原生滚动，自己实现一个限制频率</li> <li>增加 rootMargin，在距离较远之前就开始回调</li> <li>多个离屏的元素合并在一块，intersectionObserver 只监听块，一块一块的渲染</li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#为什么需要实现虚拟列表" class="sidebar-link reco-side-为什么需要实现虚拟列表" data-v-b57cc07c>为什么需要实现虚拟列表？</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#分批量渲染" class="sidebar-link reco-side-分批量渲染" data-v-b57cc07c>分批量渲染</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#定高虚拟列表" class="sidebar-link reco-side-定高虚拟列表" data-v-b57cc07c>定高虚拟列表</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#虚拟列表需要的数据" class="sidebar-link reco-side-虚拟列表需要的数据" data-v-b57cc07c>虚拟列表需要的数据</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#上下缓冲区" class="sidebar-link reco-side-上下缓冲区" data-v-b57cc07c>上下缓冲区</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#偏移量-offset" class="sidebar-link reco-side-偏移量-offset" data-v-b57cc07c>偏移量 offset</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#不定高虚拟列表" class="sidebar-link reco-side-不定高虚拟列表" data-v-b57cc07c>不定高虚拟列表</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#具体实现步骤" class="sidebar-link reco-side-具体实现步骤" data-v-b57cc07c>具体实现步骤</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#性能优化" class="sidebar-link reco-side-性能优化" data-v-b57cc07c>性能优化</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#补充-intersectionobserver-可以知道目标元素与视口之间的交叉区域" class="sidebar-link reco-side-补充-intersectionobserver-可以知道目标元素与视口之间的交叉区域" data-v-b57cc07c>补充 - IntersectionObserver 可以知道目标元素与视口之间的交叉区域</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/work/Virtual-List.html#浏览器-fps-大概-16ms-当快速滚动的时候-intersectionobserver-可视区域监听有概率不触发回调-展示上虚拟列表有些列表区域是空白的" class="sidebar-link reco-side-浏览器-fps-大概-16ms-当快速滚动的时候-intersectionobserver-可视区域监听有概率不触发回调-展示上虚拟列表有些列表区域是空白的" data-v-b57cc07c>浏览器 fps 大概 16ms，当快速滚动的时候，IntersectionObserver 可视区域监听有概率不触发回调，展示上虚拟列表有些列表区域是空白的</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.7f47a672.js" defer></script><script src="/assets/js/7.4a690826.js" defer></script><script src="/assets/js/2.cf00603f.js" defer></script><script src="/assets/js/1.24c33125.js" defer></script><script src="/assets/js/57.bc530ef3.js" defer></script>
  </body>
</html>
